A fase de criação do banco de dados consiste em interpretar os dados selecionados de modo que seja possível realizar consultas para analisar relações entre os dados, como por exemplo: informações de candidaturas de um determinado candidato ao longo de diferentes eleições.

O banco de dados se comporta como um centralizador de toda a informação adquirida esparsamente no repositório de dados. Em sua modelagem e implementação deve se ter em mente que a síntese de informações de diferentes arquivos requer um grande esforço, assim à esta etapa reservou-se uma grande parcela do tempo de execução deste trabalho.

Optou-se por dividir a etapa de criação do banco de dados em módulos que são detalhados nas subseções seguintes. Assim tanto a implementação quanto a descrição do trabalho realizado podem ser melhor compreendidos.

\subsection{Tratamento de Ambiguidade entre Palavras}\label{sub:desamb}

\subsection{Dados de Localidade}

Uma informação que é recorrente em praticamente em todos os arquivos do repositório de dados trata-se da localização de determinado acontecimento, por exemplo o local onde um candidato concorre a um determinado cargo, ou o seu local de nascimento. Essa informação representa um dado valioso para as análises propostas, pois sua disponibilidade viabiliza análises sobre tendências geográficas.

No entanto existe um problema no tratamento dessa informação, o repositório do TSE utiliza um código gerado internamente para identificar os municípios. Esse código não apresenta relação com outros sistemas do governo, assim no caso de análises geográficas não é possível, por exemplo, utilizar dados do IBGE para determinar a localização de um município.

A solução para contornar essa questão foi encontrada em um recurso criado pelo Departamento de Informática do SUS, o DATASUS~\cite{www.datasus}. Este recurso é um trabalho que tem como objetivo o aprimoramento da gestão do sistema de saúde nacional. 
Apesar de se tratar de um recurso voltado para a saúde, esse sistema apresenta uma  rica base de dados com arquivos de diversas categorias, incluindo uma categoria de unidades territoriais. 

As tabelas do DATASUS relacionadas à unidades territoriais apresentam uma hierarquia completa de níveis de detalhamento geográfico que possibilitam trabalhar desde regiões nacionais até distritos de um município, como pode ser observado na Figura~\ref{fig:datasus_ut}. 

\begin{figure}[htb]
  \centering
  \includegraphics[width=10cm]{images/datasus_ut.pdf}
  \caption{Hierarquia dos níveis de detalhamento geográfico dos dados de unidades territoriais do DATASUS.}
  \label{fig:datasus_ut}
\end{figure}

Para cada município tem-se sua localização geográfica com base em sua latitude e longitude. Além disso, o sistema mantém códigos em suas tabelas que possibilitam a comunicação com outros sistemas do governo, inclusive com o IBGE. 

A proposta deste modulo é processar os dados do SUS e permitir que em processamentos futuros seja possível estabelecer uma relação entre os dados de localidade encontrados no repositório do TSE e os dados do SUS. Para estabelecer essa relação bastaria utilizar o nome da cidade e seu estado, já que o nome da cidade é único para um estado.

Os dados do DATASUS estão no formato dBase e podem ser baixados livremente e importados por diversos softwares que suportam este formato. Os arquivos se encontram na codificação DOS/850 e esta deve ser levada em conta ao se realizar a importação dos arquivos. Este trabalho utilizou a ferramenta livre LibreOffice~\cite{www.lbo} para converter os arquivos dBase para o formato CSV e assim posteriormente processá-los juntamente com os dados do TSE.

Desenvolveu-se um processador responsável por carregar os arquivos sobre unidades territoriais do DATASUS no banco de dados. Esta tarefa resume-se a interpretar cada campo do arquivo CSV em um atributo de uma nova tabela no banco de dados. O resultado deste processamento é apresentado na Figura~\ref{fig:locations_db}.

\begin{figure}[htb]
  \centering
  \includegraphics[width=15cm]{images/locations_db.png}
  \caption{Resultado do processamento dos dados de unidades territoriais. Diagrama construído pela ferramenta \textit{SchemaSpy}~\cite{www.schemaspy}}
  \label{fig:locations_db}
\end{figure}

A tabela de regiões contém 6 entradas (\textit{rows}), 1 que designa região ignorada ou no exterior e 5 que representam as macrorregiões nacionais. Uma região contém um ou mais estados. 

Ao todo a tabela de estados contém 28 entradas, sendo elas:

\begin{itemize}
  \item 26 Unidades Federativas;
  \item Distrito Federal; e 
  \item UF ignorada ou no exterior.
\end{itemize}

As tabelas de mesorregiões e microrregiões com 165 e 586 entradas, respectivamente, representam subdivisões dos estados que congregam diversos municípios de uma área geográfica com similaridades econômicas e sociais. Ambas foram criadas pelo IBGE para fins estatísticos e não constituem entidades políticas ou administrativas. 

A tabela de cidades contém informações referentes a:

\begin{itemize}
  \item 5.565 Municípios em vigor, sendo 5.563 Municípios propriamente ditos, 1 Distrito Federal (Brasília) e 1 Distrito Estadual (Fernando de Noronha);
  \item 60 Municípios transferidos de Goiás para Tocantins, quando da criação deste; estes códigos são válidos até 31/12/1988;
  \item 1 Município extinto (Pinto Bandeira, no Rio Grande do Sul, reincorporado a Bento Gonçalves por decisão judicial); e
  \item 27 Municípios ignorados, um para cada Unidade da Federação (exceto do Distrito Federal) e um correspondendo a UF ignorada ou no exterior.
\end{itemize}

Os demais níveis de detalhamento, como distritos de municípios, não foram processados pois estão fora do interesse deste trabalho.

O processamento descrito nesta subseção estabelece uma base confiável de informações sobre as unidades territoriais do Brasil e servirá como referência no tratamento de todos atributos de localidade nos processamentos descritos nas subseções seguintes. 

\subsection{Dados de Vagas Disponíveis}

Os arquivos de vagas disponíveis contém informações sobre todas as eleições realizadas em todas unidades eleitorais. Assim, este arquivo possibilita não somente registrar o número de vagas para cada cargo como também criar a tabela eleição como mostra a Tabela~\ref{tab:election}. 

\begin{table}[h!]
  \centering
  \begin{tabular}{|l|}
    \hline
    \multicolumn{1}{|c|}{\textbf{Atributos da Tabela Eleição}} \\
    \hline
    Ano \\
    \hline
    Descrição \\
    \hline
    Estado \\
    \hline
    Cidade \\
    \hline
    Código do Cargo \\
    \hline
    Descrição do Cargo \\
    \hline
    Número de Vagas \\
    \hline
  \end{tabular}
  \caption{Atributos da tabela de eleições, resultante do processamento dos arquivos de vagas disponíveis.}
  \label{tab:election}
\end{table}

Durante o processamento dos arquivos de vagas detectou-se situações em que não havia uma correspondência entre os nomes de alguns municípios apresentados nos arquivos do TSE e os dados obtidos do SUS. Após de uma análise minuciosa das ocorrências deste problema, encontrou-se os seguintes motivos e soluções para essas situações:

\begin{itemize}
  \item Em 24 dos casos o problema é causado por divergências na grafia dos nomes como em: ``Mogi Mirim'' e ``Moji Mirim''. Situações semelhantes ocorrem pelo uso do apostrofo em nomes como ``Santa Luzia D'Oeste''. O problema foi tratado pela abordagem descrita na Subseção~\ref{sub:desamb} e determinou-se a correspondência entre os nomes para todos os 21 casos.

  \item 8 dos casos justificam-se por alterações nos nomes dos municípios, como por exemplo o município de ``Januário Cicco'' no Rio Grande do Norte que passou a se chamar ``Boa Saúde''. A solução adotada foi buscar para cada caso o nome antigo do município nos registros do IBGE~\cite{www.ibge}, conseguindo assim estabelecer a correspondência entre os nomes para esses casos.

  \item Para 5 casos verificou-se que os municípios ainda não haviam sido instalados quando os dados do SUS/IBGE foram coletados. Por isso não constam na base de dados, tratam-se de casos como o município ``Paraíso das Águas'' no Mato Grosso do Sul. A única solução para esses casos foi armazená-los na base de dados mesmo sem uma referência com os dados do SUS/IBGE. Esses municípios não poderão ser utilizados em todas as análises propostas.

\end{itemize}

O processamento descrito nessa seção foi responsável por armazenar no banco de dados 22.484 eleições realizadas em 5.568 cidades no período de 2006 à 2012. Ao todo tem-se 123.841 cargos eletivos com as seguintes distribuições:

\begin{itemize}
  \item 2 presidentes;
  \item 54 governadores;
  \item 81 senadores;
  \item 1.026 deputados federais;
  \item 2.118 deputados estaduais (sendo 48 distritais);
  \item 11.133 prefeitos; e
  \item 109.427 vereadores;

\end{itemize}

A tabela de eleições será utilizada na Subseção~\ref{sub:candidature} para definir em quais eleições os candidatos se inscreveram.

\subsection{Dados de Candidatos}\label{sub:candidature}

Verificou-se que o código utilizado pelo TSE não identifica univocamente um candidato.

\subsection{Dados de Candidatura}\label{sub:candidature}



\subsection{Dados de Bens de Candidatos}

\subsection{Dados de Prestação de Contas}


